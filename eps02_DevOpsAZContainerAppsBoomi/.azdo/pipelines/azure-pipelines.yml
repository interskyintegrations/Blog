## CI pipeline will be started on every branch
# Pipeline requires the folowing pipeline variables:

trigger:
  batch: true
  branches:
    include:    
    - main
    - feature/*

pr: none

# Use build definition name for build/release numbers
name: $(BuildDefinitionName).$(Year:yy)$(DayOfYear)$(rev:.r)

variables:
- group: boomi-dev
steps:
- script: |
    echo "Azure Service Connection: $(azureServiceConnection)"
    echo "Resource Group Name: $(devResourceGroupName)"
    echo "Location: $(location)"
  displayName: Test Variable Group


# Call the build process template
# stages:
# - stage: Build
#   variables:
#   - group: boomi-dev 
#   jobs:
#   - job: DebugBuildVars
#     displayName: Debug Variables in Build Stage
#     pool:
#       name: 'Azure Pipelines'
#     steps:
#       - script: |
#           echo "Azure Service Connection: ${{ variables.azureServiceConnection }}"
#           echo "subscriptionId: ${{ variables.subscriptionId }}"
#           echo "Location: ${{ variables.azureResourceRegion }}"
#         displayName: Debug Build Variables
  # - template: stages/build-stage-bicep.yml
  #   parameters:
  #     artifacts:
  #       - name: bicep-artifact
  #         templateDirectory: infra
  #     azureSubscription: ${{ variables.azureServiceConnection }}
  #     bicep:
  #       templateFile: infra/main.bicep
  #     pool:
  #       name: 'Azure Pipelines'

# - stage: Development 
#   dependsOn: Build
#   condition: succeeded()
#   variables:
#   - group: boomi-dev
#   jobs:
#   - template: stages/release-stage-bicep.yml
#     parameters:
#       name: 'BicepDeploy'
#       azureSubscription:  ${{ variables.azureServiceConnection }}
#       bicep: 
#         artifactName: bicep-artifact
#         parametersFile: main.parameters.dev.json
#         resourceGroupName: ${{ variables.devResourceGroupName }} 
#         location: ${{ variables.location }}
#         templateFile: main.bicep
#       devOpsEnvironment: Development
#       pool:
#         name: 'Azure Pipelines'

